import { Button } from 'theme-ui';

## What is it?

### ðŸŽƒ Headless React Hook

`useComments` just cares about the data. You write your own UI.

### ðŸ‘º Backed with Hasura

We need to keep all of these comments somewhere, right?
[Hasura](https://hasura.io), a GraphQL layer on top of a database, handles this
for us! Don't worry, you'll get your Hasura up and running in 30 seconds!

### ðŸš€ Quick and easy

The setup will take less than 5 minutes.

## Getting started

Let's add comments to a website in five simple steps!

1. **Deploy Hasura**

   Click this ðŸ‘‡ to deploy a fresh [Hasura] instance.

   <Button
     as="a"
     href="https://heroku.com/deploy?template=https://github.com/hasura/graphql-engine-heroku"
     variant="links.button"
     sx={{ my: 2 }}
   >
     Deploy Hasura to Heroku
   </Button>

   Check out [the docs][hasura-docs] for more details. You can find more options
   for one-click deployment there.

   [hasura]: https://hasura.io

   [hasura-docs]:
   https://hasura.io/docs/1.0/graphql/manual/guides/deployment/heroku-one-click.html

2. **Set config vars in Heroku**

   In order to use our Hasura backend we need to set two enviromental variables
   in Heroku.

   Setting
   [`HASURA_GRAPHQL_ADMIN_SECRET`](https://hasura.io/docs/1.0/graphql/manual/deployment/heroku/securing-graphql-endpoint.html#heroku-secure)
   makes sure that your GraphQL endpoint and the Hasura console are not publicly
   accessible.

   [`HASURA_GRAPHQL_UNAUTHORIZED_ROLE`](https://hasura.io/docs/1.0/graphql/manual/auth/authentication/unauthenticated-access.html#unauthenticated-access)
   allows unauthenticated (non-logged in) users add and view comments.

   <img width="700" src="./heroku-env.png" />

3. **Import database schema and metadata**

   In the next step we need to import database schema. Click
   [here](https://github.com/beerose/use-comments/blob/master/hasura/up.sql) and
   copy paste the content.

   <img width="600" src="./sql.png" />

   We also need to import Hasura metadata to set all the permissions. Save
   [this file](https://github.com/beerose/use-comments/blob/master/hasura/metadata.json),
   and import it in Hasura Console:

   <img width="300" src="./metadata.png" />

4. **Install `use-comments`**

   ```
   npm install use-comments
   ```

   ```
   yarn add use-comments
   ```

   ```jsx
   import { useComments, CommentStatus } from 'use-comments';

   const { comments, count, loading, refetch, error } = useComments(
     hasuraUrl,
     'landing-page'
   );
   ```

   Or add it from CDN:

   ```js
   <script
     crossorigin
     src="https://unpkg.com/use-comments@0.1.3/dist/index.umd.js"
   ></script>

   <script type="module" async>
      const { useComments } = useComments;

      const { comments, count, loading, refetch, error } = useComments(
        hasuraUrl,
        'landing-page',
      );
   </script>
   ```

   You can find your `hasuraUrl` in the Hasura Console:

   <img width="500" src="./url.png" />

5. **Create beautiful UI for your comments**

   Start off from one of the examples or write it from scratch.

   <!-- <div style="display: flex; flex-wrap: wrap;">
     <img
       style="width: 300px; height: 300px; margin-right: 20px; cursor: pointer"
       src="./t.png"
     />
     <img
       style="width: 300px; height: 300px; margin-right: 20px; cursor: pointer"
       src="./tu.png"
     />
     <img
       style="width: 300px; height: 300px; margin-right: 20px; cursor: pointer"
       src="./p.png"
     />
   </div> -->

- [Theme UI](https://codesandbox.io/s/use-comments-theme-ui-demo-hjqqj)
- [Tailwind](https://codesandbox.io/s/use-comments-demo-tailwind-pvhgw)
- [Theme UI with pagination](https://codesandbox.io/s/use-comments-pagination-z5kmg)
